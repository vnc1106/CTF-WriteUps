from Crypto.Util.number import *
p = getPrime(1024)
q = getPrime(1024)
e = 0x10001
n = p*q
d = pow(e,-1,(p-1)*(q-1))
msg = b"gimmetheflag"
flag = b'flag{local_flag}'
print("Welcome to our E-Signature Service!")
while True:
	print("Choose an option")
	print("1. Sign message")
	print("2. Get flag")
	print("3. Show Public Key")
	print("4. Exit")
	option = input("Enter option: ")
	try:
		if option == '1':
			m = int(input("Enter message to sign: "),16)
			if bytes_to_long(msg) == m:
				print("Nope hacker hehe")
				break
			s = pow(m,d,n)
			print(f"Signature: {hex(s)[2:]}\n")
		elif option == '2':
			s = int(input("Give me the signature of the message 'gimmetheflag': "),16)
			if bytes_to_long(msg) == pow(s,e,n):
				print(f"Signature matches! Here's your flag: {flag}\n")
			else:
				print("Wrong signature!!\n")
		elif option == '3':
			print(f"n={n}")
			print(f"e={e}\n")
		elif option == '4':
			break
		else:
			print("Invalid option!\n")
	except:
		print("Nope hacker hehe")
		break